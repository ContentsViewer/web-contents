---
parent: ../Troubleshooting
title: ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ã‚’é–‹ãã¾ã§Arduino-Pythoné–“ã®ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã®ãƒ‡ãƒ¼ã‚¿ç ´æ
date: 2020-07-14
tags: ã‚·ãƒªã‚¢ãƒ«é€šä¿¡, Arduino, Python
---

//Arduinoã¨Pythoné–“ã®ã‚·ãƒªã‚¢ãƒ«é€šä¿¡//ã§, 
Arduinoå´ã‹ã‚‰é€ã‚‰ã‚ŒãŸã‚·ãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’Pythonã®`pySerial`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§èª­ã¿è¾¼ã‚€ã¨,
//ç ´æã—ãŸãƒ‡ãƒ¼ã‚¿-äºˆæƒ³ã—ã¦ã„ãªã„ãƒ‡ãƒ¼ã‚¿-ã‚’å—ä¿¡//ã™ã‚‹.
ã ãŒ, //ä¸€åº¦Arduinoã®ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹ã¨æ­£å¸¸ã«å—ä¿¡//ã§ãã¦ãŠã‚Š,
//ãã‚Œä»¥é™, pythonã®æ–¹ã§ã‚‚æ­£å¸¸ã«å—ä¿¡//ã§ãã‚‹.

![pythonã§å—ä¿¡. äºˆæœŸã—ãªã„ãƒ‡ãƒ¼ã‚¿ãŒå—ä¿¡ã•ã‚Œã¦ã„ã‚‹](CURRENT_DIR/Images/corruption.jpg)

æœ¬ç¨¿ã§ã¯, ä¸Šè¨˜ã®å•é¡Œã®åŸå› ã¨è§£æ±ºæ–¹æ³•ã«ã¤ã„ã¦è¿°ã¹ã‚‹.

===

# ç—‡çŠ¶
    ç’°å¢ƒ:
        * Arduino
            * Arduino UNO
            * Arduino IDE v1.8.10
        * Windows 10 ãƒ“ãƒ«ãƒ‰ 18363.900
        * WSL1 Ubuntu -18.04
        * pythonç’°å¢ƒ
            * pipenv
        
    ã¾ãš, //Arduinoã‹ã‚‰Pythonã‚¢ãƒ—ãƒªã«ã‚·ãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ //ã‚’ä½œæˆã™ã‚‹.
    
    SerialTest:
        ```cpp
            void setup() {
              Serial.begin(19200);
            }
            
            void loop() {
              Serial.println(millis());
              delay(1000);
            }
        ```
        
        ä¸€ç§’ã”ã¨ã«ç¾åœ¨æ™‚é–“(ms)ã‚’é€ä¿¡ã™ã‚‹ã ã‘ã®å˜ç´”ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã‚‹.
    
    ã“ã®æ®µéšã§, //ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ã‚’ç¢ºèªã™ã‚‹ã¨, æ­£å¸¸ã«å–ã‚Œã¦ã„ã‚‹//ã“ã¨ãŒã‚ã‹ã‚‹.
    
    ![ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ã§ã®ç¢ºèª. æ­£å¸¸ã«ä¸€ç§’ã”ã¨ç¾åœ¨æ™‚é–“ãŒé€ã‚‰ã‚Œã¦ã„ã‚‹](CURRENT_DIR/Images/monitor.jpg)
    
    æ¬¡ã«, //å—ä¿¡ã™ã‚‹pythonã‚³ãƒ¼ãƒ‰//ã‚’ä½œæˆã™ã‚‹.
    
    serial-test.py:
        ```py
            import serial
            import time
            
            ser = serial.Serial()
            ser.baudrate = 19200
            ser.port = '/dev/ttyS9'
            ser.open()
            
            print('Serial warming up...')
            time.sleep(2)
            
            while True:
                line = ser.readline()
                print(line)
        ```
        
        ãŸã ã‚·ãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã™ã‚‹ã ã‘ã®å˜ç´”ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã‚‹.
        å¤šãã®ã‚µã‚¤ãƒˆ^[serial-sample-1]^[serial-sample-2]^[serial-sample-3]^[serial-sample-4]^[serial-sample-5]
        ã§æŒ™ã’ã‚‰ã‚Œã¦ã„ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«ä½œæˆã—ãŸ.
    
    ã“ã“ã§, //ã„ã£ãŸã‚“USBã‚’å·®ã—ãªãŠã™//.
    
    `serial-test.py`ã‚’å®Ÿè¡Œã™ã‚‹ã¨, //äºˆæœŸã—ãªã„ãƒ‡ãƒ¼ã‚¿ãŒå—ä¿¡//ã•ã‚Œã‚‹.
    
    ```
        Serial warming up...
        b'\x10\n'
        b'\x08\x01\x19\n'
        b'\n'
        b'\n'
        b'\x08\x01\x11\n'
        b'\n'
        b'\n'
        b'\n'
        b'\x08\x01\x13\x02\x02\x02\n'
        b'\x08\x01\x13\n'
        b'\n'
        b'\n'
        b'\n'
        b'\x08\x01\x15\x02\x02\x02\n'
        b'\x08\x01\x16\x02\x02\x02\n'
    ```
    
    ![pythonã§å—ä¿¡. äºˆæœŸã—ãªã„ãƒ‡ãƒ¼ã‚¿ãŒå—ä¿¡ã•ã‚Œã¦ã„ã‚‹](CURRENT_DIR/Images/corruption.jpg)
    
    ãã“ã§, //ã‚‚ã†ä¸€åº¦ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ã‚’ç«‹ã¡ä¸Šã’//, æ­£å¸¸ã«é€ã‚‰ã‚Œã¦ã„ã‚‹ã®ã‚’ç¢ºèªå¾Œ, `serial-test.py`ã‚’å®Ÿè¡Œã™ã‚‹ã¨,
    //æ­£å¸¸ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã¨ã‚‹ã“ã¨ãŒã§ãã‚‹//.
    
    
    ```
        Serial warming up...
        b'13093422\r\n'
        b'1394422\r\n'
        b'0\r\n'
        b'999\r\n'
        b'1999\r\n'
        b'3000\r\n'
        b'3999\r\n'
        b'5000\r\n'
        b'6000\r\n'
        b'7001\r\n'
    ```
    
    ![ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ã§ç¢ºèªå¾Œpythonã§å—ä¿¡. æ­£å¸¸ã«ãƒ‡ãƒ¼ã‚¿ãŒå—ä¿¡ã•ã‚Œã¦ã„ã‚‹](CURRENT_DIR/Images/after-monitor.jpg)
    
# åŸå› 
    çµæœã‹ã‚‰è¨€ã†ã¨, æ˜ç¢ºã«ã‚ã‹ã‚‰ãªã„.
    
    æ¶ˆå»æ³•ã§è€ƒãˆã¦ã„ãã¨,
    
    * ãƒœãƒ¼ãƒ¬ãƒ¼ãƒˆã®ç¢ºèª
        -> åŒã˜ã§ã‚ã‚‹
    * ãƒãƒ¼ãƒˆã®ç¢ºèª
        -> å—ä¿¡ã¯ã—ã¦ã„ã‚‹
    * `ser`ä½œæˆå¾Œã®`ser.flushInput()` `ser.flushOutput()` ã®å®Ÿè¡Œ
        -> å¤‰åŒ–ãªã—
        
        å‚è€ƒ:
            >>>
                Try to insert ser.flushInput() and ser.flushOutput() after ser creation.
            >>>
            ["Corrupted data with serial connection"](https://stackoverflow.com/questions/40951658/corrupted-data-with-serial-connection). stack overflow. (accessed at 2020-7-14)
            
    * ãƒã‚¤ãƒŠãƒªã§é€ã£ã¦ã„ã‚‹
        -> `Serial.println`ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§, æ–‡å­—ã§ã‚ã‚‹
        
        å‚è€ƒ:
            ["PySerial: Data corrupted when reading from serial port"](https://stackoverflow.com/questions/32676066/pyserial-data-corrupted-when-reading-from-serial-port). stack overflow. (accessed at 2020-7-14)
    
    
    * Arduinoã®ãƒªã‚»ãƒƒãƒˆ(ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ã®å†èµ·å‹•)ã‚’å¾…ã£ã¦ã„ãªã„
        -> å¾…ã£ã¦ã„ã‚‹
            >>>
                ```py
                print('Serial warming up...')
                time.sleep(2)
                ```
            >>>
        å‚è€ƒ:
            ["Problem with Pyserial"](https://forum.arduino.cc/index.php?topic=585676.0). Arduino Forum. (accessed at 2020-7-14)
    
# å¯¾å‡¦
    å•é¡Œã‚’å¤šãæ¤œç´¢ã—ã¦ã„ã, æœ€çµ‚çš„ã«ã“ã¡ã‚‰ã®è§£æ±ºç­–ãŒæœ‰åŠ¹ã ã£ãŸ.
    
    ["Connection using pyserial doesn't work properly"](https://forum.arduino.cc/index.php?topic=91291.0). Arduino Forum. (accessed at 2020-7-14)
    
    ã“ã®ãƒã‚¹ãƒˆã«ã‚ˆã‚‹ã¨,
    * `pySerial`ã®//ãƒ‘ãƒªãƒ†ã‚£ã‚ªãƒ—ã‚·ãƒ§ãƒ³//ã‚’ã„ã˜ã£ãŸçµæœ, `serial.PARITY_ODD`ã‚’é¸æŠã™ã‚‹ã¨æ–‡å­—ãŒé•ã£ã¦å¤‰ã ã¨ã—ã¦ã‚‚, ã‚ã‚‹ç¨‹åº¦ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå–ã‚ŒãŸ.
    * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ`serial.PARITY_NONE`ï¼‰ã«æˆ»ã™ã¨ã€ã™ã¹ã¦ãŒæ­£å¸¸ã«æ©Ÿèƒ½ã™ã‚‹.
    * ãªãœã ã‹ã‚ã‹ã‚‰ãªã„ ğŸ¥º
    * ã‚³ãƒ¼ãƒ‰ã«æ¬¡ã®ã‚‚ã®ã‚’å…¥ã‚Œã‚‹ã¨è§£æ±º
        ```py
            ser.parity = serial.PARITY_ODD
            ser.open()
            ser.close()
            ser.parity = serial.PARITY_NONE
            ser.open()
        ```
    
    ä¸Šè¨˜ã«å¾“ã£ã¦, `serial-test.py`ã‚’å¤‰æ›´
    
    serial-test.py:
        ```py
            import serial
            import time
            
            ser = serial.Serial()
            ser.baudrate = 19200
            ser.port = '/dev/ttyS9'
            ser.parity = serial.PARITY_ODD
            ser.open()
            ser.close()
            ser.parity = serial.PARITY_NONE
            ser.open()
            
            print('Serial warming up...')
            time.sleep(2)
            
            while True:
                line = ser.readline()
                print(line)
        ```
    
    //ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ã‚’é–‹ã‹ãªãã¦ã‚‚, æ­£å¸¸ã«å—ä¿¡//ã§ããŸ.
    
    ![æ­£å¸¸ã«å—ä¿¡ã§ãã¦ã„ã‚‹](CURRENT_DIR/Images/work-fine.jpg)
    
------
[serial-sample-1]: ["ã€Pythonå…¥é–€ã€‘pySerialã§ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’è§£èª¬"](https://www.sejuku.net/blog/69511). Samurai Blog. (accessed at 2020-7-14)
[serial-sample-2]: ["Pythonã§ã‚·ãƒªã‚¢ãƒ«é€šä¿¡"](https://qiita.com/kosystem/items/0023cfee941fdf099087). Qitta. (accessed at 2020-7-14)
[serial-sample-3]: ["Pythonã®pySerialã§ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã™ã‚‹æ–¹æ³•ã‚’ç¾å½¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè§£èª¬ã€åˆå¿ƒè€…å‘ã‘ã€‘"](https://techacademy.jp/magazine/24674). TECH ACADEMY. (accessed at 2020-7-14)
[serial-sample-4]: ["Arduino Python Communication Via USB"](https://www.instructables.com/id/Arduino-Python-Communication-via-USB/). instructables circuits. (accessed at 2020-7-14)
[serial-sample-5]: ["Python Datalogger - Using pySerial to Read Serial Data Output from Arduino"](https://makersportal.com/blog/2018/2/25/python-datalogger-reading-the-serial-output-from-arduino-to-analyze-data-using-pyserial). \
    Maker Portal. (accessed at 2020-7-14)